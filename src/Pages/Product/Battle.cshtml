@page
@model ContosoCrafts.WebSite.Pages.Product.BattleModel
@{
    ViewData["Title"] = "Superhero Battle";
}

<!-- Back Button -->
<div class="back-btn-container text-start">
    <a class="btn btn-primary btn-back" asp-page="/Product/Index">
        ← BACK TO SUPERHEROES
    </a>
</div>

<div class="compare-wrapper">
    <h1 class="compare-heading">Epic Battle</h1>

    @if (Model.Step == BattleModel.BattleStep.SelectHeroes)
    {
        <!-- Select the Superheros to fight -->
        <form method="post" class="compare-form mx-auto">
            <input type="hidden" asp-for="Step" value="SelectHeroes" />
            <div class="form-group">
                <label class ="form-label">Select First Superhero for Battle</label>
                <select asp-for="Hero1Id" asp-items="Model.HeroOptions">
                    <option value="">Choose Hero 1</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Select Second Superhero for Battle</label>
                <select asp-for="Hero2Id" asp-items="Model.HeroOptions">
                    <option value="">Choose Hero 2</option>
                </select>
            </div>

            <!-- Start the battle -->
            <div class="text-center mt-4">
                <button type="submit" class="btn btn-primary compare-btn">Start Battle</button>
            </div>
        </form>
    }
    else if (Model.Step == BattleModel.BattleStep.VoteWinner)
    {
        <!-- Start voting and Predict the winner -->
        <form method="post" class="compare-form mx-auto">
            <input type="hidden" asp-for="Step" value="VoteWinner" />
            <input type="hidden" asp-for="Hero1Id" />
            <input type="hidden" asp-for="Hero2Id" />

            <div class="form-group battle-vote">
                <h3>Who do you think will win?</h3> 

                <div class="form-check"> 
                    <input type="radio" asp-for="PredictedWinnerId" value="@Model.Hero1.Id" class="form-check-input" /> 
                    <label class="form-check-label">@Model.Hero1.Title</label> 
                </div> 

                <div class="form-check">
                    <input type="radio" asp-for="PredictedWinnerId" value="@Model.Hero2.Id" class="form-check-input" /> 
                    <label class="form-check-label">@Model.Hero2.Title</label>
                </div>
            </div>

            <div class="text-center mt-4">
                <button type="submit" class="btn btn-success compare-btn">Vote</button>
            </div>
        </form>
    }
    else if (Model.Step == BattleModel.BattleStep.ShowResult)
    {
        <!-- Result of Battle -->
        <div class="battle-final">
            <div class="battle-result d-flex justify-content-around align-items-center mt-5">
                <div class="winner">
                    <h3 class="text-success">🏆 Winner: @Model.ActualWinner.Title</h3>
                    <img src="@Model.ActualWinner.ImageUrl" class="card-img" alt="@Model.ActualWinner.Title" />
                </div>

                <div class="vs-text">
                    <h2>VS</h2>
                </div>

                <div class="loser">
                    <h3 class="text-danger">💀 Defeated: @(Model.Hero1.Id == Model.ActualWinner.Id ? Model.Hero2.Title : Model.Hero1.Title)</h3>
                    <img src="@(Model.Hero1.Id == Model.ActualWinner.Id ? Model.Hero2.ImageUrl : Model.Hero1.ImageUrl)"
                         class="card-img" alt="Defeated Hero" />
                </div>
            </div>

            <p class="text-center mt-3">Your prediction was @(Model.PredictedWinner.Id == Model.ActualWinner.Id ? "Correct ✅" : "Incorrect ❌")</p>

            <div class="text-center mt-4">
                <a asp-page="./Battle" class="btn btn-terciary compare-btn">Start New Battle</a>
            </div>
        </div>
    }

    @if (!ViewData.ModelState.IsValid)
    {
        <!-- Error Message if failure occurs -->
        <div class="alert alert-danger mt-3">
            @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
            {
                <div>@error.ErrorMessage</div>
            }
        </div>
    }
</div>