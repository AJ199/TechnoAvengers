
@page
@model ContosoCrafts.WebSite.Pages.Product.BattleModel
@{
    ViewData["Title"] = "Superhero Battle";
}

<div class="compare-wrapper">
    <h1 class="compare-heading">⚡ Heroic Battle ⚡</h1>

    @if (Model.Step == BattleStep.SelectHeroes)
    {
        <form method="post" class="compare-form mx-auto">
            <input type="hidden" asp-for="Step" value="SelectHeroes" />
            <div class="form-group">
                <label class ="form-label">Select First Superhero for Battle</label>
                <select asp-for="Hero1Id" asp-items="Model.HeroOptions">
                    <option value="">Choose Hero 1</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Select Second Superhero for Battle</label>
                <select asp-for="Hero2Id" asp-items="Model.HeroOptions">
                    <option value="">Choose Hero 2</option>
                </select>
            </div>

            <div class="text-center mt-4">
                <button type="submit" class="btn btn-primary compare-btn">⚔️ Start Battle ⚔️</button>
            </div>
        </form>
    }
    else if (Model.Step == BattleStep.VoteWinner)
    {
        <form method="post" class="compare-form mx-auto">
            <input type="hidden" asp-for="Step" value="VoteWinner" />
            <input type="hidden" asp-for="Hero1Id" />
            <input type="hidden" asp-for="Hero2Id" />

            <div class="form-group">
                <label class="form-label">Who do you think will win?</label> 

                <div class="form-check"> 
                    <input type="radio" asp-for="PredictedWinnerId" value="@Model.Hero1.Id" class="form-check-input" /> 
                    <label class="form-check-label">@Model.Hero1.Title</label> 
                </div> 

                <div class="form-check">
                    <input type="radio" asp-for="PredictedWinnerId" value="@Model.Hero2.Id" class="form-check-input" /> 
                    <label class="form-check-label">@Model.Hero2.Title</label>
                </div>
            </div>

            <div class="text-center mt-4">
                <button type="submit" class="btn btn-success compare-btn">📊 Vote</button>
            </div>
        </form>
    }
    else if (Model.Step == BattleStep.ShowResult)
    {
        <div class="compare-result text-center">
            <h2 class="compare-heading">🏆 Winner: @Model.ActualWinner.Title</h2>
            <p class="compare-summary">
                Your prediction was
                <strong>
                    @(Model.PredictedWinner.Id == Model.ActualWinner.Id ? "correct!" : "incorrect.")
                </strong>
            </p>
            <p class="compare-summary">@Model.ResultMessage</p>

            <a asp-page="./Battle" class="btn btn-terciary compare-btn mt-3">🔁 Start New Battle</a>
        </div>
    }

    @if (!ViewData.ModelState.IsValid)
    {
        <div class="alert alert-danger mt-3">
            @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
            {
                <div>@error.ErrorMessage</div>
            }
        </div>
    }
</div>